(function(){var t={}.hasOwnProperty,e=function(e,i){function s(){this.constructor=e}for(var o in i)t.call(i,o)&&(e[o]=i[o]);return s.prototype=i.prototype,e.prototype=new s,e.__super__=i.prototype,e},i=function(t,e){return function(){return t.apply(e,arguments)}};(function(t){var i,s,o,n,r,l,a;return s="undefined"!=typeof window&&null!==window?window:module.exports,i=null!=(o=s.Ribs)?o:s.Ribs={},i.VERSION="0.1.2",i.List=function(s){function o(t){var e,s,n,r,l,a;for(this.sortArrows={},this.sortArrows[-1]="↓",this.sortArrows[1]="↑",null==(r=this.itemView)&&(this.itemView=i.ListItem),null==(l=this.actionView)&&(this.actionView=i.BatchAction),this.events=_.extend({},this.events,this._ribsEvents),this.sortingDirection={},this.sortingBy="id",a=this._ribsOptions,s=0,n=a.length;n>s;s++)e=a[s],null!=t[e]&&(this[e]=t[e]);this.keyboardManager="function"==typeof i.getKeyboardManager?i.getKeyboardManager():void 0,null!=this.keyboardManager&&this.initializeHotKeys(),o.__super__.constructor.apply(this,arguments),this.$el.addClass("ribs")}return e(o,s),o.prototype.tagName="div",o.prototype.itemName="item",o.prototype._ribsEvents={keypress:"keypressed",focusin:"focusin",focusout:"focusout","click .header .toggle input":"toggleSelected","click .maximize .minimize":"toggleVisibility","click [data-sort-by]":"sortByField"},o.prototype._ribsOptions=["displayAttributes","actions","itemView","itemName","title","jumpkey"],o.prototype.jumpSelector=".list li:first",o.prototype.focussed=!1,o.prototype.selectedByDefault=!1,o.prototype.renderOrder=["Title","Actions","Header","List","Footer"],o.prototype.setElement=function(){return o.__super__.setElement.apply(this,arguments),this.build()},o.prototype.remove=function(){var t;return this.removeAllSubviews(),null!=(t=this.keyboardManager)&&t.deregisterView(this.keyboardNamespace),o.__super__.remove.apply(this,arguments)},o.prototype.removeAllSubviews=function(){return this.removeSubviews("list"),this.removeSubviews("action")},o.prototype.removeSubviews=function(t){var e,i,s,o;if(e=this.subviews(t))for(s=0,o=e.length;o>s;s++)i=e[s],i.remove();return this["_"+t+"Subviews"]=[]},o.prototype.subviews=function(t){return this["_"+t+"Subviews"]},o.prototype.build=function(){var t,e,i,s,o;for(this.removeAllSubviews(),this.$el.empty(),o=this.renderOrder,i=0,s=o.length;s>i;i++)e=o[i],t=e.replace(/^./,"$"+e[0].toLowerCase()),this["suppress"+e]||null!=this[t]||(this[t]=this["initialize"+e]()),this.$el.append(this[t]);return null!=this.collection?this.setCollection(this.collection):void 0},o.prototype.render=function(){return this._render(this.renderOrder),this},o.prototype._render=function(t){var e,i,s,o;for(o=[],i=0,s=t.length;s>i;i++)e=t[i],this["suppress"+e]?o.push(void 0):o.push(this["render"+e]());return o},o.prototype.setCollection=function(t){var e,i,s,o,n;for(this.collection=t,this.stopListening(this.collection),this.listenTo(this.collection,"add",this.addItem),this.listenTo(this.collection,"sort reset",this.addAllItems),n=["Actions","Footer","Header"],s=0,o=n.length;o>s;s++)i=n[s],e=this["render"+i],!this["suppress"+i]&&_.isFunction(e)&&this.listenTo(this.collection,"selected deselected add remove reset",e);return this.addAllItems(),this.suppressHeader?void 0:this.updateHeaderArrows(this.sortingBy)},o.prototype.getSelected=function(){var e=this;return null==this.$list?[]:this.$list.find(".item.selected").map(function(i,s){return e.collection.get(t(s).data("cid"))})},o.prototype.getDeselected=function(){var e=this;return null==this.$list?[]:this.$list.find(".item:not(.selected)").map(function(i,s){return e.collection.get(t(s).data("cid"))})},o.prototype.getNumSelected=function(){return null==this.$list?0:this.$list.find(".item.selected").size()},o.prototype.getNumDeselected=function(){return null==this.$list?0:this.$list.find(".item:not(.selected)").size()},o.prototype.getNumTotal=function(){return null==this.collection?0:this.collection.length},o.prototype.toggleFocussedSelected=function(){return this.suppressToggle?void 0:this.$(".item:focus").trigger("toggle")},o.prototype.toggleSelected=function(){var t,e;return this.selectedByDefault===!0?(this.$list.find(".item.selected").trigger("deselectitem",{silent:!0}),this.selectedByDefault=!1,null!=(t=this.collection)?t.trigger("deselected"):void 0):(this.$list.find(".item:not(.selected)").trigger("selectitem",{silent:!0}),this.selectedByDefault=!0,null!=(e=this.collection)?e.trigger("selected"):void 0)},o.prototype.invertSelected=function(){var t,e;return e=this.$list.find(":not(.item.selected)"),t=this.$list.find(".item.selected"),e.trigger("select"),t.trigger("deselectitem")},o.prototype.select=function(t){var e,i,s,o;for(_.isArray(t)||(t=[t]),i=0,s=t.length;s>i;i++)e=t[i],null!=(o=this.get(e))&&o.$el.trigger("selectitem",{silent:!0});return this._render(["Header","Footer","Actions"])},o.prototype.toggleVisibility=function(){return this.$header.find(".maximize, .minimize").toggle(),this.$el.toggleClass("minimized",100)},o.prototype.sortByField=function(e){var i,s,o;return s=t(e.target).attr("data-sort-by"),null!=s&&null!=this.collection?(o=this.sortingBy,this.sortingBy=s,s===o&&s in this.sortingDirection?this.sortingDirection[s]*=-1:this.sortingDirection[s]=1,i=this.sortingDirection[s],this.sortCollection(s,i),this.updateHeaderArrows(s,o)):void 0},o.prototype.sortCollection=function(t,e){var i=this;return this.collection.remoteSort?this.collection.trigger("remoteSort",t,e):(this.collection.comparator=function(s,o){var n,r,l,a;return n=s.get(t),l=i.displayAttributeMap[t],_.isFunction(l.map)&&(n=l.map.call(i,n,s)),r=o.get(t),a=i.displayAttributeMap[t],_.isFunction(a.map)&&(r=a.map.call(i,r,o)),null!=(null!=n?n.toLowerCase:void 0)&&(n=n.toLowerCase()),null!=(null!=r?r.toLowerCase:void 0)&&(r=r.toLowerCase()),n===r?0:n>r||null==r?1*e:r>n||null==n?-1*e:void 0},this.collection.sort())},o.prototype.updateHeaderArrows=function(e,i){var s,o,n,r;return n=RegExp(" ("+_.values(this.sortArrows).join("|")+")$|$"),s=null!=(r=this.sortingDirection[e])?r:1,null!=i&&this.$header.find("[data-sort-by='"+i+"'] .arrow").remove(),o=t("<span />",{"class":"arrow",text:this.sortArrows[s]}),this.$header.find("[data-sort-by='"+e+"']").append(o)},o.prototype.initializeHotKeys=function(){var e,i,s,o,n,r=this;if(this.keyboardNamespace=this.keyboardManager.registerView(this,this.plural()),null!=this.jumpkey&&this.keyboardManager.registerJumpKey({label:this.plural(),jumpkey:this.jumpkey,context:this,callback:function(){return r.$(r.jumpSelector).focus()},precondition:function(){return r.$el.is(":visible")}}),!this.suppressHotKeys){for(i=[{hotkey:"j",label:"Focus next item",callback:function(){return t(document.activeElement).nextAll(".item:visible:not(.disabled):first").focus()}},{hotkey:"J",label:"Focus last item",callback:function(){return r.$list.find(".item:last").focus()}},{hotkey:"k",label:"Focus previous item",callback:function(){return t(document.activeElement).prevAll(".item:visible:not(.disabled):first").focus()}},{hotkey:"K",label:"Focus first item",callback:function(){return r.$list.find(".item:first").focus()}},{hotkey:"x",label:"Select/deselect item",callback:function(){return r.toggleFocussedSelected()}},{hotkey:"X",label:"Select/deselect all",callback:function(){return r.toggleSelected()}},{hotkey:"_",label:"Expand/collapse list",callback:function(){return r.toggleVisibility()}},{hotkey:"R",label:"Refresh items",callback:function(){return r.refresh()}}],n=[],s=0,o=i.length;o>s;s++)e=i[s],e.namespace=this.keyboardNamespace,n.push(this.keyboardManager.registerHotKey(e));return n}},o.prototype.keypressed=function(t){var e;return this.trigger("keypressed",t),null!=(e=this.keyboardManager)?e.handleKeypress(t,this.keyboardNamespace):void 0},o.prototype.refresh=function(){var t=this;return null!=this.collection.url?(this.trigger("refresh"),this.collection.fetch({success:function(){var e;return null!=(e=t.$list.find(".item:first"))?e.focus():void 0}})):void 0},o.prototype.focusin=function(){var t;return this.focussed||(this.focussed=!0),this.$el.addClass("focussed"),null!=(t=this.collection)?t.trigger("focusin"):void 0},o.prototype.focusout=function(){var t=this;return this.focussed?setTimeout(function(){var e;return 0===t.$(document.activeElement).length&&t.$el.removeClass("focussed"),t.focussed=!1,null!=(e=t.collection)?e.trigger("focusout"):void 0},10):void 0},o.prototype.plural=function(){var t;return null!=(t=this.itemNamePlural)?t:this.itemName+"s"},o.prototype.addItem=function(t){var e,i,s,o;return i=Backbone.View.prototype.isPrototypeOf(this.itemView.prototype)?this.itemView:this.itemView(t),s=new i({model:t,view:this}),e=this.collection.indexOf(t),0===(o=this.$list.children().size())||o===e?this.$list.append(s.el):this.$list.children(":nth-child("+(e+1)+")").before(s.el),s.render(),this.subviews("list").push(s),this.selectedByDefault?s.select():void 0},o.prototype.addAllItems=function(){var t;return this.removeSubviews("list"),this.$list.empty(),null!=(t=this.collection)?t.each(this.addItem,this):void 0},o.prototype.get=function(t){return _.find(this.subviews("list"),function(e){return e.model.id===t})},o.prototype.initializeTitle=function(){var e,i,s;return i=null!=(s=this.title)?s:this.plural(),_.isFunction(i)&&(i=i.call(this)),e=t("<h1 />",{"class":"title",text:i})},o.prototype.renderTitle=function(){},o.prototype.initializeActions=function(){var e,s,o,n,r,l,a,c=this;for(this.removeSubviews("action"),e=t("<ul/>",{"class":"actions"}),n=_.reject(this.actions,function(t){return null!=t.available&&!t.available.call(c)}),this.allActions=new i.Actions(n,{ribs:this}),this.inlineActions=this.allActions.where({inline:!0}),this.batchActions=this.allActions.where({batch:!0}),a=this.batchActions,r=0,l=a.length;l>r;r++)s=a[r],o=new this.actionView({model:s}),this.subviews("action").push(o),e.append(o.el),o.render();return e},o.prototype.renderActions=function(){var t,e,i,s,o;for(s=this.subviews("action"),o=[],e=0,i=s.length;i>e;e++)t=s[e],o.push(t.render());return o},o.prototype.initializeList=function(){var e;return e=t("<ul/>",{"class":"list"})},o.prototype.renderList=function(){var t,e,i,s,o;for(s=this.subviews("list"),o=[],e=0,i=s.length;i>e;e++)t=s[e],t.render(),o.push(t.delegateEvents());return o},o.prototype.initializeHeader=function(){var e,i,s,o=this;return e=t("<div />",{"class":"header"}),this.suppressToggle||(s=t("<input />",{type:"checkbox",checked:this.selectedByDefault}),e.append(t("<div />",{"class":"toggle",html:s}))),null==this.displayAttributes&&(i=_.map(this.collection.first().toJSON(),function(t,e){return{field:e}})),this.displayAttributeMap={},_.each(this.displayAttributes,function(i){var s,n,r,l,a;return o.displayAttributeMap[i.field]=i,r=null!=(l=i.label)?l:i.field,n=null!=(a=i["class"])?a:i.field,s=t("<div/>",{"class":n,"data-sort-by":i.sortField||i.field}),s.append(r),e.append(s)}),e},o.prototype.renderHeader=function(){var t,e,i,s,o;return s=this.getNumSelected(),i=this.getNumTotal(),s>=i&&(this.selectedByDefault=!0),0===s&&(this.selectedByDefault=!1),t=0!==s,e=t&&i>s,o=e?.5:1,this.$header.find(".toggle input").prop("checked",t).css("opacity",o)},o.prototype.initializeFooter=function(){var e;return e=t("<div/>",{"class":"footer"})},o.prototype.renderFooter=function(){var t,e;return t=1!==this.getNumTotal(),e=t?this.plural():this.itemName,this.$footer.text(""+this.getNumSelected()+" / "+this.getNumTotal()+" "+e+" selected")},o}(Backbone.View),i.ListItem=function(s){function o(t){var e,s,n,r,l,a,c,u,h,p,d;for(this.events||(this.events={}),_.extend(this.events,this._ribsEvents),null==(u=this.itemCellView)&&(this.itemCellView=i.ListItemCell),null==(h=this.actionView)&&(this.actionView=i.InlineAction),this.view=null!=t?t.view:void 0,this.listItemCells=[],p=this.view.displayAttributes,a=0,c=p.length;c>a;a++)s=p[a],s=_.clone(s),s.view=this,s.model=t.model,l=new this.itemCellView(s),this.listItemCells.push(l);this.inlineActions=[],d=this.view.inlineActions;for(r in d)e=d[r],(null==e.filter||e.filter(this.model)!==!1)&&(n=new this.actionView({model:e,listItem:this}),this.inlineActions.push(n));o.__super__.constructor.apply(this,arguments),null!=this.model&&(this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"remove",this.remove))}return e(o,s),o.prototype.tagName="li",o.prototype.className="item",o.prototype.attributes={tabindex:0},o.prototype._ribsEvents={click:"toggle",toggle:"toggle",selectitem:"select",deselectitem:"deselect","click a":"stopPropogation"},o.prototype.render=function(){var e,i,s,o,n,r,l,a,c,u,h;if(this.$el.empty(),this.model){for(this.$el.data("cid",this.model.cid),this.view.suppressToggle||(o=t("<input/>",{type:"checkbox",tabindex:-1}),this.$el.is(".selected")&&t(o).prop("checked",!0),i=t("<div/>",{"class":"toggle"}),i.append(o),this.$el.append(i)),u=this.listItemCells,r=0,a=u.length;a>r;r++)e=u[r],this.$el.append(e.el),e.render(),e.delegateEvents();for(n=t("<ul/>",{"class":"actions"}),h=this.inlineActions,l=0,c=h.length;c>l;l++)s=h[l],t(n).append(s.el),s.render(),s.delegateEvents();return this.$el.append(n),this}},o.prototype.toggle=function(){return this.$el.is(".disabled")?void 0:this.$el.is(".selected")?this.deselect():this.select()},o.prototype.stopPropogation=function(t){return t.stopImmediatePropagation()},o.prototype.select=function(t,e){return null==e&&(e={}),this.view.suppressToggle?void 0:(this.$el.addClass("selected"),this.$("input:checkbox").prop("checked",!0),e.silent?void 0:this.model.trigger("selected"))},o.prototype.deselect=function(t,e){return null==e&&(e={}),this.view.suppressToggle?void 0:(this.$el.removeClass("selected"),this.$("input:checkbox").prop("checked",!1),e.silent?void 0:this.model.trigger("deselected"))},o.prototype.enable=function(){return this.$el.removeClass("disabled"),this.$("input:checkbox").prop("disabled",!1),this.$el.prop("tabindex",0),this.model.trigger("enabled")},o.prototype.disable=function(){return this.$el.addClass("disabled"),this.$("input:checkbox").prop("disabled",!0),this.$el.prop("tabindex",-1),this.model.trigger("disabled")},o.prototype.remove=function(){var t,e,i,s,n,r,l,a;for(this.deselect(),l=this.inlineActions,i=0,n=l.length;n>i;i++)t=l[i],t.remove();for(a=this.listItemCells,s=0,r=a.length;r>s;s++)e=a[s],e.remove();return o.__super__.remove.apply(this,arguments)},o}(Backbone.View),i.ListItemCell=function(i){function s(){var t;this.events||(this.events={}),_.extend(this.events,this._ribsEvents),s.__super__.constructor.apply(this,arguments),this.$el.addClass(null!=(t=this.options["class"])?t:this.options.field)}return e(s,i),s.prototype.tagName="div",s.prototype.className="cell",s.prototype._ribsEvents={"click .edit":"edit","click .editableField":"stopPropagation","keypress .editableField":"handleKeypress","blur .editableField":"saveEditedField"},s.prototype.renderableValue=function(t){var e;return e=this.model.get(this.options.field),!t&&_.isFunction(this.options.map)&&(e=this.options.map.call(this.options.view.view,e,this.model)),null!=e?e:""},s.prototype.render=function(){var e,i,s,o;return this.$el.empty(),this.options.escape===!1?this.$el.html(this.renderableValue()):this.$el.text(this.renderableValue()),this.options.editable===!0&&(i=null!=(s=this.options.label)?s:this.options.field,e=t("<span/>",{"class":"edit button inline",title:"Edit "+i,text:"✎"}),void 0===(o=this.model.get(this.options.field))||null===o||""===o?t(e).addClass("show"):t(e).removeClass("show"),this.$el.append(e)),this},s.prototype.edit=function(){var e,i,s,o,n,r,l,a,c;if(this.options.editable===!0){if(n=this.model.get(this.options.field),_.isFunction(this.options.edit))e=this.options.edit.call(this,n,this.model);else if(_.isArray(this.options.edit))for(e=t("<select/>"),a=this.options.edit,r=0,l=a.length;l>r;r++)s=a[r],o=t("<option/>",{value:s,text:s,selected:s===n}),e.append(o);else if(_.isObject(this.options.edit)){e=t("<select/>"),c=this.options.edit;for(i in c)s=c[i],o=t("<option/>",{value:i,text:s,selected:i===n}),e.append(o)}else e=t("<input/>",{type:"text",value:n});(_.isElement(e)||e instanceof jQuery)&&(t(e).addClass("editableField"),this.$el.html(e),t(e).focus())}return!1},s.prototype.stopPropagation=function(){return!1},s.prototype.saveEditedField=function(){var e,i,s,o,n=this;if(s=this.$(".editableField"),_.isFunction(this.options.save))return this.options.save.call(this,s,this.model);if(o=s.val(),e=t.extend(!0,{},this.model.attributes),e[this.options.field]=o,this.model._validate(e,this.model))try{return this.model.save(e,{success:function(){return n.render()},error:function(){return n.render()}})}catch(r){return i=r,this.render()}},s.prototype.handleKeypress=function(t){return 13===t.which?(this.saveEditedField(),!1):void 0},s}(Backbone.View),i.Action=function(t){function s(){return n=s.__super__.constructor.apply(this,arguments)}return e(s,t),s.prototype.defaults={min:1,max:-1,arity:null,check:null,batch:!0,inline:!1},s.prototype.initialize=function(t,e){var s,o,n,r=this;return this.ribs=null!=(o=e.ribs)?o:this.collection.ribs,this.has("actions")&&(s=_.reject(this.get("actions"),function(t){return null!=t.available&&!t.available.call(r.ribs)}),this.actions=new i.Actions(s,{ribs:this.ribs}),this.min=0),this.has("hotkey")&&!this.ribs.suppressHotKeys?null!=(n=this.ribs.keyboardManager)?n.registerHotKey({hotkey:this.get("hotkey"),label:this.get("label"),namespace:this.ribs.keyboardNamespace,context:this,precondition:this.allowed,callback:function(){return r.activate()}}):void 0:void 0},s.prototype.allowed=function(t){var e,i,s,o,n;return null==t&&(t=this.getSelected()),s=t.length,i=!1,null!=this.get("arity")?(e=this.get("arity"),o=e===s,n=-1===e,i=o||n):(o=-1===this.get("min")||s>=this.get("min"),n=-1===this.get("max")||this.get("max")>=s,i=o&&n),i&&null!=this.get("check")&&(i=this.get("check").call(this.ribs,t)),i},s.prototype.activate=function(t,e){var i;return null==t&&(t=this.getSelected()),i=this.get("activate"),_.isFunction(i)?i.call(this.ribs,t,e):void 0},s.prototype.getSelected=function(){return this.ribs.getSelected()},s}(Backbone.Model),i.Actions=function(t){function s(){return r=s.__super__.constructor.apply(this,arguments)}return e(s,t),s.prototype.model=i.Action,s}(Backbone.Collection),i.BatchAction=function(s){function o(){return l=o.__super__.constructor.apply(this,arguments)}return e(o,s),o.prototype.tagName="li",o.prototype.className="action",o.prototype.events={click:"activateIfAllowed",keypress:"keypressed"},o.prototype.attributes={tabindex:0},o.prototype.render=function(){var e,s;return e=t("<div/>",{"class":"button",title:this.tooltip(),html:this.label()}),this.$el.html(e),this.model.actions?(s=t("<ul/>",{"class":"dropdown",title:this.label(!1)}),this.model.actions.each(function(e){var o;return o=new i.BatchAction({model:e}),t(s).append(o.el),o.render()}),t(e).append(s)):this.checkRequirements(),this},o.prototype.tooltip=function(){var t;return null!=(t=this.model.get("tooltip"))?t:this.label(!1)},o.prototype.label=function(t){var e,i;return null==t&&(t=!0),e=null!=(i=this.model.get("batchLabel"))?i:this.model.get("label"),t&&this.model.has("hotkey")&&(e=this.constructor.highlightHotkey(e,this.model.get("hotkey"))),e},o.prototype.getSelected=function(){return this.model.getSelected()},o.prototype.getListItem=function(){},o.prototype.checkRequirements=function(){return this.setEnabled(this.model.allowed(this.getSelected()))},o.prototype.setEnabled=function(t){var e;return this.$el.toggleClass("disabled",!t),e=t?0:-1,this.$el.prop("tabindex",e)},o.prototype.activate=function(){return this.model.activate(this.getSelected(),this.getListItem()),!1},o.prototype.activateIfAllowed=function(){return this.$el.is(".disabled")||this.activate(),!1},o.prototype.keypressed=function(t){return 13===t.which?(this.activate(),!1):void 0},o.highlightHotkey=function(t,e){var i,s;return s=_.template("<span class='hotkey'><strong><%= hotkey %></strong></span>"),i=t.replace(e,s({hotkey:e})),i===t&&(i=""+t+" "+s({hotkey:"["+e+"]"})),i},o}(Backbone.View),i.InlineAction=function(t){function i(){return a=i.__super__.constructor.apply(this,arguments)}return e(i,t),i.prototype.label=function(){var t,e;return t=null!=(e=this.model.get("inlineLabel"))?e:this.model.get("label"),_.isFunction(t)&&(t=t.call(this.model,this.options.listItem.model)),t},i.prototype.getSelected=function(){return[this.options.listItem.model]},i.prototype.getListItem=function(){return this.options.listItem},i}(i.BatchAction)})(jQuery),function(t){var s,o,n,r,l;return o="undefined"!=typeof window&&null!==window?window:module.exports,s=null!=(r=o.Ribs)?r:o.Ribs={},n=null,s.getKeyboardManager=function(){return null!=n?n:n=new s.KeyboardManager},s.KeyboardManager=function(){function e(e){this.handleKeypress=i(this.handleKeypress,this),this.options=_.extend(this.options,e),this.registerHotKey({hotkey:"?",callback:this.showKeyboardBindings,context:this,label:"Show hotkeys"}),t(window).on("keypress",this.handleKeypress)}return e.prototype.boundCharCodes={},e.prototype.registeredViews={global:{bindings:[],tree:{},label:"Global",context:window}},e.prototype.options={jumpPrefixKey:"g",jumpTime:1e3,enableKeyboardShortcuts:!0},e.prototype.registerView=function(t,e){var i;return i=_.uniqueId("view"),this.registeredViews[i]={label:e,context:t,tree:{},bindings:[]},i},e.prototype.deregisterView=function(t){return delete this.registeredViews[t]},e.prototype.registerHotKey=function(t){var e,i,s,n,r,l,a,c,u,h;for(null==(a=t.charCodes)&&(t.charCodes=function(){var e,i,o,n;for(o=t.hotkey.split(""),n=[],e=0,i=o.length;i>e;e++)s=o[e],n.push(s.charCodeAt(0));return n}()),n=null!=(c=t.namespace)?c:t.namespace="global",o=this.registeredViews[n].tree,u=t.charCodes,i=r=0,l=u.length;l>r;i=++r)e=u[i],null==(h=o[e])&&(o[e]={bindings:[],upcoming:0}),i===t.charCodes.length-1?o[e].bindings.push(t):o[e].upcoming+=1,o=o[e];return this.registeredViews[n].bindings.push(t),n},e.prototype.deregisterHotKey=function(t){var e,i,s,n,r,l,a,c,u,h,p;for(null==(c=t.charCodes)&&(t.charCodes=function(){var e,i,s,o;for(s=t.hotkey.split(""),o=[],e=0,i=s.length;i>e;e++)n=s[e],o.push(n.charCodeAt(0));return o}()),r=null!=(u=t.namespace)?u:t.namespace="global",o=i=this.registeredViews[r].tree,h=t.charCodes,p=[],s=l=0,a=h.length;a>l;s=++l)e=h[s],i=i[e],s===t.charCodes.length-1?p.push(i.bindings=_.reject(i.bindings,function(e){return!(t.context&&t.context!==e.context||t.callback&&t.callback!==e.callback)})):p.push(i.upcoming-=1);return p},e.prototype.registerJumpKey=function(t){return t.label="Go to "+t.label,t.hotkey=this.options.jumpPrefixKey+t.jumpkey,this.registerHotKey(t)},e.prototype.deregisterJumpKey=function(t){return t.hotkey=this.options.jumpPrefixKey+t.jumpkey,this.deregisterHotKey(t)},e.prototype.handleKeypress=function(e,i){var s,o;return null==i&&(i="global"),this.options.enableKeyboardShortcuts&&!t(document.activeElement).is(":input")?(s=null!=(o=this.currentContext)?o:this.registeredViews[i].tree,null!=s?this.walkContext(s,e.which):void 0):void 0},e.prototype.walkContext=function(t,e){var i=this;return this.jumpTimeout&&clearTimeout(this.jumpTimeout),delete this.currentContext,e in t?(t=t[e],0===t.upcoming?this.execute(t):(this.currentContext=t,this.jumpTimeout=setTimeout(function(){return delete i.currentContext,i.execute(t)},this.options.jumpTime)),!1):void 0},e.prototype.execute=function(t){var e,i,s,o,n,r,l;if(t.bindings.length){for(n=t.bindings,l=[],s=0,o=n.length;o>s;s++)e=n[s],i=null!=(r=e.context)?r:this.registeredViews[e.namespace].context,!e.precondition||e.precondition.call(i)?l.push(e.callback.call(i)):l.push(void 0);return l}},e.prototype.showKeyboardBindings=function(){var e,i;return null!=(i=this.constructor.view)&&i.$el.remove(),e=this.constructor.view=new s.KeyboardHelpView({views:this.registeredViews,hotkeys:this.boundCharCodes}),e.render(),t("body").append(e.el)},e}(),s.KeyboardHelpView=function(s){function o(){return this.handleKeyup=i(this.handleKeyup,this),l=o.__super__.constructor.apply(this,arguments)}return e(o,s),o.prototype.className="ribs-keyboard-shortcuts-overlay",o.prototype.events={click:"remove"},o.prototype.initialize=function(){return t(window).on("keyup",this.handleKeyup)},o.prototype.remove=function(){return t(window).off("keyup",this.handleKeyup),o.__super__.remove.apply(this,arguments)},o.prototype.handleKeyup=function(t){return 27===t.which&&this.remove(),!1},o.prototype.render=function(){var e,i,s,o,n,r,l,a,c,u,h,p;this.$el.empty(),c=this.options.views,p=[];for(o in c)if(r=c[o],t(null!=(u=r.context)?u.el:void 0).is(":hidden"))p.push(void 0);else{for(i=t("<h1/>",{text:r.label}),n=t("<ul/>"),h=r.bindings,l=0,a=h.length;a>l;l++)e=h[l],s=t("<li/>",{"class":"hotkey"}),s.append(t("<span/>",{"class":"key",text:e.hotkey})),s.append(t("<span/>",{"class":"action",text:e.label})),n.append(s);p.push(this.$el.append(i,n))}return p},o}(Backbone.View)}(jQuery)}).call(this);