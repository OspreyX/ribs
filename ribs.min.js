(function(){var t={}.hasOwnProperty,e=function(e,i){function s(){this.constructor=e}for(var n in i)t.call(i,n)&&(e[n]=i[n]);return s.prototype=i.prototype,e.prototype=new s,e.__super__=i.prototype,e},i=function(t,e){return function(){return t.apply(e,arguments)}};!function(t){var i,s;return s="undefined"!=typeof window&&null!==window?window:module.exports,i=null!=s.Ribs?s.Ribs:s.Ribs={},i.VERSION="0.1.2",i.List=function(s){function n(t){var e,s,o,r;for(this.sortArrows={},this.sortArrows[-1]="↓",this.sortArrows[1]="↑",null==this.itemView&&(this.itemView=i.ListItem),null==this.actionView&&(this.actionView=i.BatchAction),this.events=_.extend({},this.events,this._ribsEvents),this.sortingDirection={},this.sortingBy="id",r=this._ribsOptions,s=0,o=r.length;o>s;s++)e=r[s],null!=t[e]&&(this[e]=t[e]);this.keyboardManager="function"==typeof i.getKeyboardManager?i.getKeyboardManager():void 0,null!=this.keyboardManager&&this.initializeHotKeys(),n.__super__.constructor.apply(this,arguments),this.$el.addClass("ribs")}return e(n,s),n.prototype.tagName="div",n.prototype.itemName="item",n.prototype._ribsEvents={keypress:"keypressed",focusin:"focusin",focusout:"focusout","click .header .toggle input":"toggleSelected","click .maximize .minimize":"toggleVisibility","click [data-sort-by]":"sortByField"},n.prototype._ribsOptions=["displayAttributes","actions","itemView","itemName","title","jumpkey"],n.prototype.jumpSelector=".list li:first",n.prototype.focussed=!1,n.prototype.selectedByDefault=!1,n.prototype.renderOrder=["Title","Actions","Header","List","Footer"],n.prototype.setElement=function(){return n.__super__.setElement.apply(this,arguments),this.build()},n.prototype.remove=function(){var t;return this.removeAllSubviews(),null!=(t=this.keyboardManager)&&t.deregisterView(this.keyboardNamespace),n.__super__.remove.apply(this,arguments)},n.prototype.removeAllSubviews=function(){return this.removeSubviews("list"),this.removeSubviews("action")},n.prototype.removeSubviews=function(t){var e,i,s,n;if(e=this.subviews(t))for(s=0,n=e.length;n>s;s++)i=e[s],i.remove();return this["_"+t+"Subviews"]=[]},n.prototype.subviews=function(t){return this["_"+t+"Subviews"]},n.prototype.build=function(){var t,e,i,s,n;for(this.removeAllSubviews(),this.$el.empty(),n=this.renderOrder,i=0,s=n.length;s>i;i++)e=n[i],t=e.replace(/^./,"$"+e[0].toLowerCase()),this["suppress"+e]||null!=this[t]||(this[t]=this["initialize"+e]()),this.$el.append(this[t]);return null!=this.collection?this.setCollection(this.collection):void 0},n.prototype.delegateEvents=function(){var t,e,i,s,o,r;for(n.__super__.delegateEvents.apply(this,arguments),o=["list","actions"],r=[],i=0,s=o.length;s>i;i++)t=o[i],null!=this.subviews(t)&&r.push(function(){var i,s,n,o;for(n=this.subviews(t),o=[],i=0,s=n.length;s>i;i++)e=n[i],o.push(e.delegateEvents());return o}.call(this));return r},n.prototype.render=function(){return this._render(this.renderOrder),this},n.prototype._render=function(t){var e,i,s,n;for(n=[],i=0,s=t.length;s>i;i++)e=t[i],n.push(this["suppress"+e]?void 0:this["render"+e]());return n},n.prototype.setCollection=function(t){var e,i,s,n,o;for(this.collection=t,this.stopListening(this.collection),this.listenTo(this.collection,"add",this.addItem),this.listenTo(this.collection,"sort reset",this.addAllItems),o=["Actions","Footer","Header"],s=0,n=o.length;n>s;s++)i=o[s],e=this["render"+i],!this["suppress"+i]&&_.isFunction(e)&&this.listenTo(this.collection,"selected deselected add remove reset",e);return this.addAllItems(),this.suppressHeader?void 0:this.updateHeaderArrows(this.sortingBy)},n.prototype.getSelected=function(){return null==this.$list?[]:this.$list.find(".item.selected").map(function(e){return function(i,s){return e.collection.get(t(s).data("cid"))}}(this))},n.prototype.getDeselected=function(){return null==this.$list?[]:this.$list.find(".item:not(.selected)").map(function(e){return function(i,s){return e.collection.get(t(s).data("cid"))}}(this))},n.prototype.getNumSelected=function(){return null==this.$list?0:this.$list.find(".item.selected").size()},n.prototype.getNumDeselected=function(){return null==this.$list?0:this.$list.find(".item:not(.selected)").size()},n.prototype.getNumTotal=function(){return null==this.collection?0:this.collection.length},n.prototype.toggleFocussedSelected=function(){return this.suppressToggle?void 0:this.$(".item:focus").trigger("toggle")},n.prototype.toggleSelected=function(){var t,e;return this.selectedByDefault===!0?(this.$list.find(".item.selected").trigger("deselectitem",{silent:!0}),this.selectedByDefault=!1,null!=(t=this.collection)?t.trigger("deselected"):void 0):(this.$list.find(".item:not(.selected)").trigger("selectitem",{silent:!0}),this.selectedByDefault=!0,null!=(e=this.collection)?e.trigger("selected"):void 0)},n.prototype.invertSelected=function(){var t,e;return e=this.$list.find(":not(.item.selected)"),t=this.$list.find(".item.selected"),e.trigger("select"),t.trigger("deselectitem")},n.prototype.select=function(t){var e,i,s,n;for(_.isArray(t)||(t=[t]),i=0,s=t.length;s>i;i++)e=t[i],null!=(n=this.get(e))&&n.$el.trigger("selectitem",{silent:!0});return this._render(["Header","Footer","Actions"])},n.prototype.toggleVisibility=function(){return this.$header.find(".maximize, .minimize").toggle(),this.$el.toggleClass("minimized",100)},n.prototype.sortByField=function(e){var i,s,n;return s=t(e.target).attr("data-sort-by"),null!=s&&null!=this.collection?(n=this.sortingBy,this.sortingBy=s,s===n&&s in this.sortingDirection?this.sortingDirection[s]*=-1:this.sortingDirection[s]=1,i=this.sortingDirection[s],this.sortCollection(s,i),this.updateHeaderArrows(s,n)):void 0},n.prototype.sortCollection=function(t,e){return this.collection.remoteSort?this.collection.trigger("remoteSort",t,e):(this.collection.comparator=function(i){return function(s,n){var o,r,l,u;return o=s.get(t),l=i.displayAttributeMap[t],_.isFunction(l.map)&&(o=l.map.call(i,o,s)),r=n.get(t),u=i.displayAttributeMap[t],_.isFunction(u.map)&&(r=u.map.call(i,r,n)),null!=(null!=o?o.toLowerCase:void 0)&&(o=o.toLowerCase()),null!=(null!=r?r.toLowerCase:void 0)&&(r=r.toLowerCase()),o===r?0:o>r||null==r?1*e:r>o||null==o?-1*e:void 0}}(this),this.collection.sort())},n.prototype.updateHeaderArrows=function(e,i){var s,n,o,r;return o=new RegExp(" ("+_.values(this.sortArrows).join("|")+")$|$"),s=null!=(r=this.sortingDirection[e])?r:1,null!=i&&this.$header.find("[data-sort-by='"+i+"'] .arrow").remove(),n=t("<span />",{"class":"arrow",text:this.sortArrows[s]}),this.$header.find("[data-sort-by='"+e+"']").append(n)},n.prototype.initializeHotKeys=function(){var e,i,s,n,o;if(this.keyboardNamespace=this.keyboardManager.registerView(this,this.plural()),null!=this.jumpkey&&this.keyboardManager.registerJumpKey({label:this.plural(),jumpkey:this.jumpkey,context:this,callback:function(t){return function(){return t.$(t.jumpSelector).focus()}}(this),precondition:function(t){return function(){return t.$el.is(":visible")}}(this)}),!this.suppressHotKeys){for(i=[{hotkey:"j",label:"Focus next item",callback:function(){return function(){return t(document.activeElement).nextAll(".item:visible:not(.disabled):first").focus()}}(this)},{hotkey:"J",label:"Focus last item",callback:function(t){return function(){return t.$list.find(".item:last").focus()}}(this)},{hotkey:"k",label:"Focus previous item",callback:function(){return function(){return t(document.activeElement).prevAll(".item:visible:not(.disabled):first").focus()}}(this)},{hotkey:"K",label:"Focus first item",callback:function(t){return function(){return t.$list.find(".item:first").focus()}}(this)},{hotkey:"x",label:"Select/deselect item",callback:function(t){return function(){return t.toggleFocussedSelected()}}(this)},{hotkey:"X",label:"Select/deselect all",callback:function(t){return function(){return t.toggleSelected()}}(this)},{hotkey:"_",label:"Expand/collapse list",callback:function(t){return function(){return t.toggleVisibility()}}(this)},{hotkey:"R",label:"Refresh items",callback:function(t){return function(){return t.refresh()}}(this)}],o=[],s=0,n=i.length;n>s;s++)e=i[s],e.namespace=this.keyboardNamespace,o.push(this.keyboardManager.registerHotKey(e));return o}},n.prototype.keypressed=function(t){var e;return this.trigger("keypressed",t),null!=(e=this.keyboardManager)?e.handleKeypress(t,this.keyboardNamespace):void 0},n.prototype.refresh=function(){return null!=this.collection.url?(this.trigger("refresh"),this.collection.fetch({success:function(t){return function(){var e;return null!=(e=t.$list.find(".item:first"))?e.focus():void 0}}(this)})):void 0},n.prototype.focusin=function(){var t;return this.focussed||(this.focussed=!0),this.$el.addClass("focussed"),null!=(t=this.collection)?t.trigger("focusin"):void 0},n.prototype.focusout=function(){return this.focussed?setTimeout(function(t){return function(){var e;return 0===t.$(document.activeElement).length&&t.$el.removeClass("focussed"),t.focussed=!1,null!=(e=t.collection)?e.trigger("focusout"):void 0}}(this),10):void 0},n.prototype.plural=function(){var t;return null!=(t=this.itemNamePlural)?t:this.itemName+"s"},n.prototype.addItem=function(t){var e,i,s,n;return i=Backbone.View.prototype.isPrototypeOf(this.itemView.prototype)?this.itemView:this.itemView(t),s=new i({model:t,view:this}),e=this.collection.indexOf(t),0===(n=this.$list.children().size())||n===e?this.$list.append(s.el):this.$list.children(":nth-child("+(e+1)+")").before(s.el),s.render(),this.subviews("list").push(s),this.selectedByDefault?s.select():void 0},n.prototype.addAllItems=function(){var t;return this.removeSubviews("list"),this.$list.empty(),null!=(t=this.collection)?t.each(this.addItem,this):void 0},n.prototype.get=function(t){return _.find(this.subviews("list"),function(e){return e.model.id===t})},n.prototype.initializeTitle=function(){var e,i,s;return i=null!=(s=this.title)?s:this.plural(),_.isFunction(i)&&(i=i.call(this)),e=t("<h1 />",{"class":"title",text:i})},n.prototype.renderTitle=function(){},n.prototype.initializeActions=function(){var e,s,n,o,r,l,u;for(this.removeSubviews("action"),e=t("<ul/>",{"class":"actions"}),o=_.reject(this.actions,function(t){return function(e){return null!=e.available&&!e.available.call(t)}}(this)),this.allActions=new i.Actions(o,{ribs:this}),this.inlineActions=this.allActions.where({inline:!0}),this.batchActions=this.allActions.where({batch:!0}),u=this.batchActions,r=0,l=u.length;l>r;r++)s=u[r],n=new this.actionView({model:s}),this.subviews("action").push(n),e.append(n.el),n.render();return e},n.prototype.renderActions=function(){var t,e,i,s,n;for(s=this.subviews("action"),n=[],e=0,i=s.length;i>e;e++)t=s[e],t.render(),n.push(t.delegateEvents());return n},n.prototype.initializeList=function(){var e;return e=t("<ul/>",{"class":"list"})},n.prototype.renderList=function(){var t,e,i,s,n;for(s=this.subviews("list"),n=[],e=0,i=s.length;i>e;e++)t=s[e],t.render(),n.push(t.delegateEvents());return n},n.prototype.initializeHeader=function(){var e,i,s;return e=t("<div />",{"class":"header"}),this.suppressToggle||(s=t("<input />",{type:"checkbox",checked:this.selectedByDefault}),e.append(t("<div />",{"class":"toggle",html:s}))),null==this.displayAttributes&&(i=_.map(this.collection.first().toJSON(),function(t,e){return{field:e}})),this.displayAttributeMap={},_.each(this.displayAttributes,function(i){return function(s){var n,o,r,l,u;return i.displayAttributeMap[s.field]=s,r=null!=(l=s.label)?l:s.field,o=null!=(u=s["class"])?u:s.field,n=t("<div/>",{"class":o,"data-sort-by":s.sortField||s.field}),n.append(r),e.append(n)}}(this)),e},n.prototype.renderHeader=function(){var t,e,i,s,n;return s=this.getNumSelected(),i=this.getNumTotal(),s>=i&&(this.selectedByDefault=!0),0===s&&(this.selectedByDefault=!1),t=0!==s,e=t&&i>s,n=e?.5:1,this.$header.find(".toggle input").prop("checked",t).css("opacity",n)},n.prototype.initializeFooter=function(){var e;return e=t("<div/>",{"class":"footer"})},n.prototype.renderFooter=function(){var t,e;return t=1!==this.getNumTotal(),e=t?this.plural():this.itemName,this.$footer.text(""+this.getNumSelected()+" / "+this.getNumTotal()+" "+e+" selected")},n}(Backbone.View),i.ListItem=function(s){function n(t){var e,s,o,r,l,u,c,a,h;for(this.events||(this.events={}),_.extend(this.events,this._ribsEvents),null==this.itemCellView&&(this.itemCellView=i.ListItemCell),null==this.actionView&&(this.actionView=i.InlineAction),this.view=null!=t?t.view:void 0,this.listItemCells=[],a=this.view.displayAttributes,u=0,c=a.length;c>u;u++)s=a[u],s=_.clone(s),s.view=this,s.model=t.model,l=new this.itemCellView(s),this.listItemCells.push(l);this.inlineActions=[],h=this.view.inlineActions;for(r in h)e=h[r],(null==e.filter||e.filter(this.model)!==!1)&&(o=new this.actionView({model:e,listItem:this}),this.inlineActions.push(o));n.__super__.constructor.apply(this,arguments),null!=this.model&&(this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"remove",this.remove))}return e(n,s),n.prototype.tagName="li",n.prototype.className="item",n.prototype.attributes={tabindex:0},n.prototype._ribsEvents={click:"toggle",toggle:"toggle",selectitem:"select",deselectitem:"deselect","click a":"stopPropogation"},n.prototype.render=function(){var e,i,s,n,o,r,l,u,c,a,h;if(this.$el.empty(),this.model){for(this.$el.data("cid",this.model.cid),o=t("<ul/>",{"class":"actions"}),a=this.inlineActions,r=0,u=a.length;u>r;r++)s=a[r],t(o).append(s.el),s.render(),s.delegateEvents();for(this.$el.append(o),this.view.suppressToggle||(n=t("<input/>",{type:"checkbox",tabindex:-1}),this.$el.is(".selected")&&t(n).prop("checked",!0),i=t("<div/>",{"class":"toggle"}),i.append(n),this.$el.append(i)),h=this.listItemCells,l=0,c=h.length;c>l;l++)e=h[l],this.$el.append(e.el),e.render(),e.delegateEvents();return this}},n.prototype.toggle=function(){return this.$el.is(".disabled")?void 0:this.$el.is(".selected")?this.deselect():this.select()},n.prototype.stopPropogation=function(t){return t.stopImmediatePropagation()},n.prototype.select=function(t,e){return null==e&&(e={}),this.view.suppressToggle?void 0:(this.$el.addClass("selected"),this.$("input:checkbox").prop("checked",!0),e.silent?void 0:this.model.trigger("selected"))},n.prototype.deselect=function(t,e){return null==e&&(e={}),this.view.suppressToggle?void 0:(this.$el.removeClass("selected"),this.$("input:checkbox").prop("checked",!1),e.silent?void 0:this.model.trigger("deselected"))},n.prototype.enable=function(){return this.$el.removeClass("disabled"),this.$("input:checkbox").prop("disabled",!1),this.$el.prop("tabindex",0),this.model.trigger("enabled")},n.prototype.disable=function(){return this.$el.addClass("disabled"),this.$("input:checkbox").prop("disabled",!0),this.$el.prop("tabindex",-1),this.model.trigger("disabled")},n.prototype.remove=function(){var t,e,i,s,o,r,l,u;for(this.deselect(),l=this.inlineActions,i=0,o=l.length;o>i;i++)t=l[i],t.remove();for(u=this.listItemCells,s=0,r=u.length;r>s;s++)e=u[s],e.remove();return n.__super__.remove.apply(this,arguments)},n}(Backbone.View),i.ListItemCell=function(i){function s(t){var e;this.events||(this.events={}),_.extend(this.events,this._ribsEvents),s.__super__.constructor.apply(this,arguments),this.field=t.field,this.view=t.view,this.map=t.map,this.escape=t.escape,this.editable=t.editable,this.label=t.label,this.edit=t.edit,this.save=t.save,this.$el.addClass(null!=(e=t["class"])?e:t.field)}return e(s,i),s.prototype.tagName="div",s.prototype.className="cell",s.prototype._ribsEvents={"click .edit":"handleEdit","click .editableField":"stopPropagation","keypress .editableField":"handleKeypress","blur .editableField":"saveEditedField"},s.prototype.renderableValue=function(t){var e;return e=this.model.get(this.field),!t&&_.isFunction(this.map)&&(e=this.map.call(this.view.view,e,this.model)),null!=e?e:""},s.prototype.render=function(){var e,i,s,n;return this.$el.empty(),this.escape===!1?this.$el.html(this.renderableValue()):this.$el.text(this.renderableValue()),this.editable===!0&&(i=null!=(s=this.label)?s:this.field,e=t("<span/>",{"class":"edit button inline",title:"Edit "+i,text:"✎"}),(void 0===(n=this.model.get(this.field))||null===n||""===n)&&t(e).addClass("show"),this.$el.append(e)),this},s.prototype.handleEdit=function(e){var i,s,n,o,r,l,u,c,a;if(this.editable===!0){if(r=this.model.get(this.field),_.isFunction(this.edit))i=this.edit.call(this,r,this.model);else if(_.isArray(this.edit))for(i=t("<select/>"),c=this.edit,l=0,u=c.length;u>l;l++)n=c[l],o=t("<option/>",{value:n,text:n}),i.append(o),t(o).prop("selected",n===r);else if(_.isObject(this.edit)){i=t("<select/>"),a=this.edit;for(s in a)n=a[s],o=t("<option/>",{value:s,text:n}),t(o).prop("selected",s===r),i.append(o)}else i=t("<input/>",{type:"text",value:r});(_.isElement(i)||i instanceof jQuery)&&(t(i).addClass("editableField"),this.$el.html(i),t(i).focus())}return e.preventDefault(),!1},s.prototype.stopPropagation=function(t){return t.preventDefault(),!1},s.prototype.saveEditedField=function(){var e,i,s,n;if(s=this.$(".editableField"),_.isFunction(this.save))return this.save.call(this,s,this.model);if(n=s.val(),e=t.extend(!0,{},this.model.attributes),e[this.field]=n,this.model._validate(e,this.model))try{return this.model.save(e,{success:function(t){return function(){return t.render()}}(this),error:function(t){return function(){return t.render()}}(this)})}catch(o){return i=o,this.render()}},s.prototype.handleKeypress=function(t){return 13===t.which?(this.saveEditedField(),!1):void 0},s}(Backbone.View),i.Action=function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return e(s,t),s.prototype.defaults={min:1,max:-1,arity:null,check:null,batch:!0,inline:!1},s.prototype.initialize=function(t,e){var s,n,o;return this.ribs=null!=(n=e.ribs)?n:this.collection.ribs,this.has("actions")&&(s=_.reject(this.get("actions"),function(t){return function(e){return null!=e.available&&!e.available.call(t.ribs)}}(this)),this.actions=new i.Actions(s,{ribs:this.ribs}),this.min=0),this.has("hotkey")&&!this.ribs.suppressHotKeys?null!=(o=this.ribs.keyboardManager)?o.registerHotKey({hotkey:this.get("hotkey"),label:this.get("label"),namespace:this.ribs.keyboardNamespace,context:this,precondition:this.allowed,callback:function(t){return function(){return t.activate()}}(this)}):void 0:void 0},s.prototype.allowed=function(t){var e,i,s,n,o;return null==t&&(t=this.getSelected()),s=t.length,i=!1,null!=this.get("arity")?(e=this.get("arity"),n=e===s,o=-1===e,i=n||o):(n=-1===this.get("min")||s>=this.get("min"),o=-1===this.get("max")||s<=this.get("max"),i=n&&o),i&&null!=this.get("check")&&(i=this.get("check").call(this.ribs,t)),i},s.prototype.activate=function(t,e){var i;return null==t&&(t=this.getSelected()),i=this.get("activate"),_.isFunction(i)?i.call(this.ribs,t,e):void 0},s.prototype.getSelected=function(){return this.ribs.getSelected()},s}(Backbone.Model),i.Actions=function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return e(s,t),s.prototype.model=i.Action,s}(Backbone.Collection),i.BatchAction=function(s){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,s),n.prototype.tagName="li",n.prototype.className="action",n.prototype.events={click:"activateIfAllowed",keypress:"keypressed"},n.prototype.attributes={tabindex:0},n.prototype.render=function(){var e,s;return e=t("<div/>",{"class":"button",title:this.tooltip(),html:this.label()}),this.$el.html(e),this.model.actions?(s=t("<ul/>",{"class":"dropdown",title:this.label(!1)}),this.model.actions.each(function(e){var n;return n=new i.BatchAction({model:e}),t(s).append(n.el),n.render()}),t(e).append(s)):this.checkRequirements(),this},n.prototype.tooltip=function(){var t;return null!=(t=this.model.get("tooltip"))?t:this.label(!1)},n.prototype.label=function(t){var e,i;return null==t&&(t=!0),e=null!=(i=this.model.get("batchLabel"))?i:this.model.get("label"),t&&this.model.has("hotkey")&&(e=this.constructor.highlightHotkey(e,this.model.get("hotkey"))),e},n.prototype.getSelected=function(){return this.model.getSelected()},n.prototype.getListItem=function(){},n.prototype.checkRequirements=function(){return this.setEnabled(this.model.allowed(this.getSelected()))},n.prototype.setEnabled=function(t){var e;return this.$el.toggleClass("disabled",!t),e=t?0:-1,this.$el.prop("tabindex",e)},n.prototype.activate=function(){return this.model.activate(this.getSelected(),this.getListItem()),!1},n.prototype.activateIfAllowed=function(){return this.$el.is(".disabled")||this.activate(),!1},n.prototype.keypressed=function(t){return 13===t.which?(this.activate(),!1):void 0},n.highlightHotkey=function(t,e){var i,s;return s=_.template("<span class='hotkey'><strong><%= hotkey %></strong></span>"),i=t.replace(e,s({hotkey:e})),i===t&&(i=""+t+" "+s({hotkey:"["+e+"]"})),i},n}(Backbone.View),i.InlineAction=function(t){function i(t){i.__super__.constructor.apply(this,arguments),this.listItem=t.listItem}return e(i,t),i.prototype.label=function(){var t,e;return t=null!=(e=this.model.get("inlineLabel"))?e:this.model.get("label"),_.isFunction(t)&&(t=t.call(this.model,this.listItem.model)),t},i.prototype.getSelected=function(){return[this.listItem.model]},i.prototype.getListItem=function(){return this.listItem},i}(i.BatchAction)}(jQuery),function(t){var s,n,o;return n="undefined"!=typeof window&&null!==window?window:module.exports,s=null!=n.Ribs?n.Ribs:n.Ribs={},o=null,s.getKeyboardManager=function(){return null!=o?o:o=new s.KeyboardManager},s.KeyboardManager=function(){function e(e){this.handleKeypress=i(this.handleKeypress,this),this.options=_.extend(this.options,e),this.registerHotKey({hotkey:"?",callback:this.showKeyboardBindings,context:this,label:"Show hotkeys"}),t(window).on("keypress",this.handleKeypress)}return e.prototype.boundCharCodes={},e.prototype.registeredViews={global:{bindings:[],tree:{},label:"Global",context:window}},e.prototype.options={jumpPrefixKey:"g",jumpTime:1e3,enableKeyboardShortcuts:!0},e.prototype.registerView=function(t,e){var i;return i=_.uniqueId("view"),this.registeredViews[i]={label:e,context:t,tree:{},bindings:[]},i},e.prototype.deregisterView=function(t){return delete this.registeredViews[t]},e.prototype.registerHotKey=function(t){var e,i,s,o,r,l,u;for(null==t.charCodes&&(t.charCodes=function(){var e,i,n,o;for(n=t.hotkey.split(""),o=[],e=0,i=n.length;i>e;e++)s=n[e],o.push(s.charCodeAt(0));return o}()),o=null!=t.namespace?t.namespace:t.namespace="global",n=this.registeredViews[o].tree,u=t.charCodes,i=r=0,l=u.length;l>r;i=++r)e=u[i],null==n[e]&&(n[e]={bindings:[],upcoming:0}),i===t.charCodes.length-1?n[e].bindings.push(t):n[e].upcoming+=1,n=n[e];return this.registeredViews[o].bindings.push(t),o},e.prototype.deregisterHotKey=function(t){var e,i,s,o,r,l,u,c,a;for(null==t.charCodes&&(t.charCodes=function(){var e,i,s,n;for(s=t.hotkey.split(""),n=[],e=0,i=s.length;i>e;e++)o=s[e],n.push(o.charCodeAt(0));return n}()),r=null!=t.namespace?t.namespace:t.namespace="global",n=i=this.registeredViews[r].tree,c=t.charCodes,a=[],s=l=0,u=c.length;u>l;s=++l)e=c[s],i=i[e],a.push(s===t.charCodes.length-1?i.bindings=_.reject(i.bindings,function(e){return!(t.context&&t.context!==e.context||t.callback&&t.callback!==e.callback)}):i.upcoming-=1);return a},e.prototype.registerJumpKey=function(t){return t.label="Go to "+t.label,t.hotkey=this.options.jumpPrefixKey+t.jumpkey,this.registerHotKey(t)},e.prototype.deregisterJumpKey=function(t){return t.hotkey=this.options.jumpPrefixKey+t.jumpkey,this.deregisterHotKey(t)},e.prototype.handleKeypress=function(e,i){var s,n;return null==i&&(i="global"),this.options.enableKeyboardShortcuts&&!t(document.activeElement).not(":radio").not(":checkbox").not(":button").is(":input,[contenteditable]")?(s=null!=(n=this.currentContext)?n:this.registeredViews[i].tree,null!=s?this.walkContext(s,e.which):void 0):void 0},e.prototype.walkContext=function(t,e){return this.jumpTimeout&&clearTimeout(this.jumpTimeout),delete this.currentContext,e in t?(t=t[e],0===t.upcoming?this.execute(t):(this.currentContext=t,this.jumpTimeout=setTimeout(function(e){return function(){return delete e.currentContext,e.execute(t)}}(this),this.options.jumpTime)),!1):void 0},e.prototype.execute=function(t){var e,i,s,n,o,r,l;if(t.bindings.length){for(o=t.bindings,l=[],s=0,n=o.length;n>s;s++)e=o[s],i=null!=(r=e.context)?r:this.registeredViews[e.namespace].context,l.push(!e.precondition||e.precondition.call(i)?e.callback.call(i):void 0);return l}},e.prototype.showKeyboardBindings=function(){var e,i;return null!=(i=this.constructor.view)&&i.$el.remove(),e=this.constructor.view=new s.KeyboardHelpView({views:this.registeredViews,hotkeys:this.boundCharCodes}),e.render(),t("body").append(e.el)},e}(),s.KeyboardHelpView=function(s){function n(){return this.handleKeyup=i(this.handleKeyup,this),n.__super__.constructor.apply(this,arguments)}return e(n,s),n.prototype.className="ribs-keyboard-shortcuts-overlay",n.prototype.events={click:"remove"},n.prototype.initialize=function(e){return this.views=e.views,t(window).on("keyup",this.handleKeyup)},n.prototype.remove=function(){return t(window).off("keyup",this.handleKeyup),n.__super__.remove.apply(this,arguments)},n.prototype.handleKeyup=function(t){return 27===t.which&&this.remove(),!1},n.prototype.render=function(){var e,i,s,n,o,r,l,u,c,a,h,p,d,f;this.$el.empty(),p=this.views,f=[];for(l in p)if(c=p[l],i=c.bindings,o=t(null!=(d=c.context)?d.el:void 0).is(":hidden"),n=0===Object.keys(i).length,o||n)f.push(void 0);else{for(s=t("<h1/>",{text:c.label}),u=t("<ul/>"),a=0,h=i.length;h>a;a++)e=i[a],r=t("<li/>",{"class":"hotkey"}),r.append(t("<span/>",{"class":"key",text:e.hotkey})),r.append(t("<span/>",{"class":"action",text:e.label})),u.append(r);f.push(this.$el.append(s,u))}return f},n}(Backbone.View)}(jQuery)}).call(this);