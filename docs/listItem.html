<!DOCTYPE html>

<html>
<head>
  <title>listItem.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="Changelog.html">
                Changelog.md
              </a>
            
              
              <a class="source" href="README.html">
                README.md
              </a>
            
              
              <a class="source" href="todos.html">
                todos.js
              </a>
            
              
              <a class="source" href="hotkeys.html">
                hotkeys.coffee
              </a>
            
              
              <a class="source" href="action.js.html">
                action.js.coffee
              </a>
            
              
              <a class="source" href="ribs.html">
                ribs.coffee
              </a>
            
              
              <a class="source" href="batchAction.js.html">
                batchAction.js.coffee
              </a>
            
              
              <a class="source" href="inlineAction.js.html">
                inlineAction.js.coffee
              </a>
            
              
              <a class="source" href="keyboardHelp.html">
                keyboardHelp.coffee
              </a>
            
              
              <a class="source" href="list.html">
                list.coffee
              </a>
            
              
              <a class="source" href="listItem.html">
                listItem.coffee
              </a>
            
              
              <a class="source" href="listItemCell.html">
                listItemCell.coffee
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>listItem.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>do ($=jQuery) -&gt;
    class Ribs.ListItem extends Backbone.View

        tagName: "li"

        className: "item"

        attributes:
            tabindex: 0

        _ribsEvents:
            'click' : 'toggle'
            'toggle' : 'toggle'
            'selectitem' : 'select'
            'deselectitem' : 'deselect'
            'click a' : 'stopPropogation'

        constructor : (options) -&gt;

            @events ||= {}
            _.extend @events, @_ribsEvents

            @itemCellView ?= Ribs.ListItemCell
            @actionView ?= Ribs.InlineAction
            @view = options?.view</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>create cell views</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-property">@listItemCells</span> = []
            <span class="hljs-keyword">for</span> attribute <span class="hljs-keyword">in</span> <span class="hljs-property">@view</span>.displayAttributes
                attribute = _.clone(attribute)
                attribute.view = @
                attribute.model = options.model
                listItemCell = <span class="hljs-keyword">new</span> <span class="hljs-property">@itemCellView</span> attribute
                <span class="hljs-property">@listItemCells</span>.push listItemCell

            <span class="hljs-property">@inlineActions</span> = []
            <span class="hljs-keyword">for</span> key, action <span class="hljs-keyword">of</span> <span class="hljs-property">@view</span>.inlineActions
                <span class="hljs-keyword">unless</span> action.filter? <span class="hljs-keyword">and</span> action.filter(<span class="hljs-property">@model</span>) <span class="hljs-keyword">is</span> <span class="hljs-literal">false</span>
                    inlineAction = <span class="hljs-keyword">new</span> <span class="hljs-property">@actionView</span>
                        <span class="hljs-attribute">model</span>: action
                        <span class="hljs-attribute">listItem</span>: <span class="hljs-keyword">this</span>
                    <span class="hljs-property">@inlineActions</span>.push inlineAction

            <span class="hljs-keyword">super</span>

            <span class="hljs-keyword">if</span> <span class="hljs-property">@model</span>?
                <span class="hljs-property">@listenTo</span> <span class="hljs-property">@model</span>, <span class="hljs-string">"change"</span>, <span class="hljs-property">@render</span>
                <span class="hljs-property">@listenTo</span> <span class="hljs-property">@model</span>, <span class="hljs-string">"remove"</span>, <span class="hljs-property">@remove</span>

        render :<span class="hljs-function"> -&gt;</span>

            <span class="hljs-property">@$el</span>.empty()
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">unless</span> <span class="hljs-property">@model</span>
            <span class="hljs-property">@$el</span>.data(<span class="hljs-string">"cid"</span>, <span class="hljs-property">@model</span>.cid)</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Add inline actions.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            ul = $ "&lt;ul/&gt;", class: "actions"
            for inlineAction in @inlineActions
                $(ul).append inlineAction.el
                inlineAction.render()
                inlineAction.delegateEvents()
            @$el.append ul</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Add selection toggle</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            unless @view.suppressToggle
                toggle = $ "&lt;input/&gt;",
                    type: "checkbox"
                    tabindex: -1
                if @$el.is ".selected"
                    $(toggle).prop "checked", true
                div = $ "&lt;div/&gt;", class: "toggle"
                div.append toggle
                @$el.append div</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Add individual cells</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">for</span> cell <span class="hljs-keyword">in</span> <span class="hljs-property">@listItemCells</span>
                <span class="hljs-property">@$el</span>.append cell.el
                cell.render()
                cell.delegateEvents()
            
            <span class="hljs-keyword">this</span>

        <span class="hljs-attribute">toggle</span>: <span class="hljs-function"><span class="hljs-params">(e)</span> -&gt;</span>
            <span class="hljs-keyword">unless</span> <span class="hljs-property">@$el</span>.<span class="hljs-keyword">is</span>(<span class="hljs-string">".disabled"</span>)
                <span class="hljs-keyword">if</span> <span class="hljs-property">@$el</span>.<span class="hljs-keyword">is</span>(<span class="hljs-string">".selected"</span>)
                    <span class="hljs-property">@deselect</span>()
                    <span class="hljs-property">@view</span>.lastSelected = <span class="hljs-literal">null</span>
                <span class="hljs-keyword">else</span>
                    <span class="hljs-property">@select</span>()
                    <span class="hljs-property">@multiSelect</span>(e)
                    <span class="hljs-property">@view</span>.lastSelected = <span class="hljs-property">@$el</span>

        <span class="hljs-attribute">multiSelect</span>: <span class="hljs-function"><span class="hljs-params">(e)</span> -&gt;</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">unless</span> e.shiftKey <span class="hljs-keyword">and</span> <span class="hljs-property">@view</span>.lastSelected</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Find in which direction the previous selected element is located</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> <span class="hljs-property">@$el</span>.prevAll().filter(<span class="hljs-property">@view</span>.lastSelected).length
                elements = <span class="hljs-property">@$el</span>.prevUntil(<span class="hljs-property">@view</span>.lastSelected)
            <span class="hljs-keyword">else</span>
                elements = <span class="hljs-property">@$el</span>.nextUntil(<span class="hljs-property">@view</span>.lastSelected)</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Check each one of the elements</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            elements.find(<span class="hljs-string">'input:checkbox:not(:checked)'</span>).click()

        <span class="hljs-attribute">stopPropogation</span>: <span class="hljs-function"><span class="hljs-params">(e)</span> -&gt;</span>
            e.stopImmediatePropagation()

        <span class="hljs-attribute">select</span>: <span class="hljs-function"><span class="hljs-params">(event, options={})</span>-&gt;</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@view</span>.suppressToggle
            <span class="hljs-property">@$el</span>.addClass <span class="hljs-string">"selected"</span>
            <span class="hljs-property">@$</span>(<span class="hljs-string">"input:checkbox"</span>).prop <span class="hljs-string">"checked"</span>, <span class="hljs-literal">true</span>
            <span class="hljs-property">@model</span>.trigger <span class="hljs-string">"selected"</span> <span class="hljs-keyword">unless</span> options.silent

        deselect : <span class="hljs-function"><span class="hljs-params">(event, options={})</span>-&gt;</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@view</span>.suppressToggle
            <span class="hljs-property">@$el</span>.removeClass <span class="hljs-string">"selected"</span>
            <span class="hljs-property">@$</span>(<span class="hljs-string">"input:checkbox"</span>).prop <span class="hljs-string">"checked"</span>, <span class="hljs-literal">false</span>
            <span class="hljs-property">@model</span>.trigger <span class="hljs-string">"deselected"</span> <span class="hljs-keyword">unless</span> options.silent

        enable :<span class="hljs-function"> -&gt;</span>
            <span class="hljs-property">@$el</span>.removeClass <span class="hljs-string">"disabled"</span>
            <span class="hljs-property">@$</span>(<span class="hljs-string">"input:checkbox"</span>).prop <span class="hljs-string">"disabled"</span>, <span class="hljs-literal">false</span>
            <span class="hljs-property">@$el</span>.prop <span class="hljs-string">"tabindex"</span>, <span class="hljs-number">0</span>
            <span class="hljs-property">@model</span>.trigger <span class="hljs-string">"enabled"</span>

        disable :<span class="hljs-function">-&gt;</span> 
            <span class="hljs-property">@$el</span>.addClass <span class="hljs-string">"disabled"</span>
            <span class="hljs-property">@$</span>(<span class="hljs-string">"input:checkbox"</span>).prop <span class="hljs-string">"disabled"</span>, <span class="hljs-literal">true</span>
            <span class="hljs-property">@$el</span>.prop <span class="hljs-string">"tabindex"</span>, -<span class="hljs-number">1</span>
            <span class="hljs-property">@model</span>.trigger <span class="hljs-string">"disabled"</span>

        <span class="hljs-attribute">remove</span>:<span class="hljs-function"> -&gt;</span>
            <span class="hljs-property">@deselect</span>()
            <span class="hljs-keyword">for</span> inlineAction <span class="hljs-keyword">in</span> <span class="hljs-property">@inlineActions</span>
                inlineAction.remove()
            <span class="hljs-keyword">for</span> listItemCell <span class="hljs-keyword">in</span> <span class="hljs-property">@listItemCells</span>
                listItemCell.remove()
            <span class="hljs-keyword">super</span></pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
